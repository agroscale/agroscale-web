# Evaluation

By measuring utility of a household with or without insurance, we can evaluate insurance products. The best insurance products are those that provide households the highest average utility. Now let us simulate 50 years of income for a household $i$ in a given zone $z$.

```{r ins1}
set.seed(12345)
income <- rweibull(50, shape = 7.3, scale = 700)
head(income)
mu <- mean(income)
mu

```
Assume that the household receives payouts equal to how low their income is from a given **trigger** value multiplied by their average over 50 years.

```{r ins2}
pay <- function(income, trigger){
  mu <- mean(income)
  trigger_val <- trigger * mu
  ifelse(income < trigger_val,
                  trigger_val - income, 
                  0)
}

payouts <- pay(income, trigger=1)
nopay     <- sum(payouts==0)
cat("The household did not receive payouts ",nopay, " times out the 50 years. \n") 

```

Let us now compute insurance premium paid by this household. Normally the insurance is marked up to cater for administrative costs. From the perspective of the client, a contract is **actuarially fair** if the premiums paid are equal to the expected value of compensation (payouts) paid. Therefore, we can estimate the premium from the average payouts received by a  client multiplied by some mark-up. 

```{r ins3}
# The actuarially fair price (afp) equals the premium when markup equals 0
markup <-  0.0
premium <- mean(payouts) * (1+markup)
premium

```

Now subtract the cost of the premium from income (this is an expense). Then plot make plots of income with and without insurance. What do you learn?

```{r ins4}
income_with_insurance =  income + payouts - premium
plot(income, income, col="red",  xlim=range(income), ylim=range(income), type="l")
lines(sort(income), sort(income_with_insurance), xlim=range(income), ylim=range(income_with_insurance), type="l", col="green")
legend("bottomright", lty = 1, col = c("red", "green"), legend=c('Income without insurance','Income with insurance'))

```

Basically, we can see that insurance cushioned the individual/household when their income fell their average income in 50 years. During the good states of the world income of the household with insurance was lower than without because an individual incurs insurance premium cost. We can perceive this also by computing absolute and relative benefit of insurance and graphing it as below.

```{r ins4b}
benefit <- income_with_insurance - income 
plot(sort(benefit), ylab="absolute benefit", xlab="Period (years)", type="l")
abline(v=nopay, col = "red")
text(nopay, max(benefit), "Paid", srt=0.2, col = "green", pos=4)
text(nopay, max(benefit), "Nopay", col = "red", pos=1)

plot(sort(benefit /  income), ylab="relative benefit", xlab="Period (years)", type = "l")
abline(v=nopay, col = "red")
text(nopay, max(benefit /income), "Paid", srt=0.2, col = "green", pos=4)
text(nopay, max(benefit /  income), "Nopay", col = "red", pos=1)

```

The next thing we wish to evaluate is if this insurance scheme was beneficial at all to the individual. Let us compute CE with and without insurance using $0 \leq rho \leq 5$. Add an insurance mark up of 25% and 75% then compare to previous one with 0 mark up.

```{r ins5, message=FALSE}
library(agrins)
rho <- seq(0,5,1)

markup <- 0.75
premium <- mean(payouts) * (1+markup)
income_ins75 <-  income + payouts - premium
ce_ins75    <- array(NA, dim=length(rho))

markup <- 0.25
premium <- mean(payouts) * (1+markup)
income_ins25 <-  income + payouts - premium
ce_ins25    <- array(NA, dim=length(rho))

markup <- 0
premium <- mean(payouts) * (1+markup)
income_ins_no_markup <-  income + payouts - premium
ce_ins_no_markup  <- array(NA, dim=length(rho))
ce_no_ins <- array(NA, dim=length(rho))
for(i in 1:length(rho)){
  ce_ins_no_markup[i] <- agrins::ce_income(income_ins_no_markup, rho=rho[i])
  ce_ins75[i]   <- agrins::ce_income(income_ins75, rho=rho[i])
  ce_ins25[i]   <- agrins::ce_income(income_ins25, rho=rho[i])
  ce_no_ins[i] <- agrins::ce_income(income, rho=rho[i])
}

```

Plot CE with and without insurance over the ranges of $rho$ used previously.

```{r ins6}
plot(rho, ce_no_ins, type="l",  col = "black", ylab ="Certainty Equivalent [$]", xlab ="Risk Aversion Coefficient", ylim=c(min(ce_no_ins)-200, max(ce_no_ins)))
lines(rho, ce_ins75, col = "blue")
lines(rho, ce_ins25, col = "green")
lines(rho, ce_ins_no_markup, col = "red")
legend("bottomleft", c('No Insurance', "75% Mark up", "25% Mark up", 'No mark up'), lty = 1, col = c("black", "blue", "green","red"), bty="n", ncol=2)

```
The plots illustrates measured well being of the farmer in certain income equivalents under different risk (CRRA). For instance, the insurance does not help if risk is neutral while the help diminishes as mark-up increases from 25% to 75%. If the farmer decides to go it alone then his/her average income is 1372 USD, but its certainty equivalent is only 1335.25 USD when $\rho= 2$. When insurance is marked-up 25% it passes the MQS test (as demonstrated later) if the farmer is above average risk averse $\rho \geq 2.5$. When insurance is 75% marked-up it is not suitable at all to this farmer.

Now let us determine if this insurance contract passes the welfare test ( -1 is bad, 0 is no effect, 1 is good) using Minimum Quality Standard (MQS) test. The MQS test goal is to answer the question; "would a household be better off without insurance or with insurance?" If the farmer would be better off economically buying insurance, then we will say that the insurance contract meets the Minimum Quality Standard (MQS) hence 1.

```{r mqs01}
library(agrins)
mqs
```

Use the MQS function to perform welfare test. To accomplish this, we will use already computed CE with and without insurance using risk aversion values $0 \leq rho \leq 2$. 

```{r mqs02}
#Test for 75% mark up
mqs75 <- mqs(ce_ins75, ce_no_ins)
data.frame(mqs75, rho)
#Test for 25% mark up
mqs25 <- mqs(ce_ins25, ce_no_ins)
data.frame(mqs25, rho)
#Test for no mark up
mqs_nomarkup <- mqs(ce_ins_no_markup, ce_no_ins)
data.frame(mqs_nomarkup, rho)

```

In this section we have illustrated principle of insurance evaluation using income of one farmer. However, in reality evaluation of insurance contracts at individual level may not be the best apprpach because of moral hazard. In this case insurance contracts normally given to farmers in following some zones where payouts are also computed. The [next section](area_yield.html) will illustrate this principle as applied to area yield contract.

